---
import searchIcon from "../assets/icon-search.svg";
import locationIcon from "../assets/icon-location.svg";
import websiteIcon from "../assets/icon-website.svg";
import twitterIcon from "../assets/icon-twitter.svg";
import companyIcon from "../assets/icon-company.svg";
---

<form id="search-form" class="relative mb-8 ">
    <input id="search-input" type="text" placeholder="Search GitHub username…" class="w-full h-16 pl-12 pr-28 rounded-xl bg-white dark:bg-neutral-800 shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
    <img src={searchIcon.src} alt="search icon" class="absolute top-1/2 left-4 -translate-y-1/2" width={searchIcon.width} height={searchIcon.height}>
    <button type="submit" class="absolute top-1/2 right-2 -translate-y-1/2 px-6 py-3 rounded-lg bg-blue-500 text-white font-bold">Search</button>
</form>

<div id="error-container"></div>
<div 
    id="user-container"
    data-location-icon={locationIcon.src}
    data-website-icon={websiteIcon.src}
    data-twitter-icon={twitterIcon.src}
    data-company-icon={companyIcon.src}
></div>

<script>
    const searchForm = document.getElementById('search-form') as HTMLFormElement;
    const searchInput = document.getElementById('search-input') as HTMLInputElement;
    const errorContainer = document.getElementById('error-container') as HTMLDivElement;
    const userContainer = document.getElementById('user-container') as HTMLDivElement;

    const { 
        locationIcon, 
        websiteIcon, 
        twitterIcon, 
        companyIcon 
    } = userContainer.dataset;

    async function fetchUser(username: string) {
        try {
            const response = await fetch(`https://api.github.com/users/${username}`);
            if (!response.ok) {
                throw new Error('User not found');
            }
            const user = await response.json();
            console.log(user)
            errorContainer.innerHTML = '';
            userContainer.innerHTML = `
                <div class="p-8 bg-white dark:bg-neutral-800 rounded-xl shadow-lg">
                    <div class="flex items-center">
                        <img src="${user.avatar_url}" alt="user avatar" class="w-24 h-24 rounded-full">
                        <div class="ml-8">
                            <h2 class="text-2xl font-bold">${user.name || user.login}</h2>
                            <p class="text-blue-500">@${user.login}</p>
                            <p class="text-gray-500">Joined ${new Date(user.created_at).toLocaleDateString('en-US', { day: 'numeric', month: 'short', year: 'numeric' })}</p>
                        </div>
                    </div>
                    <p class="mt-8">${user.bio || 'This profile has no bio'}</p>
                    <div class="flex justify-between mt-8 p-4 bg-neutral-100 dark:bg-neutral-900 rounded-xl">
                        <div>
                            <p class="text-gray-500">Repos</p>
                            <p class="text-2xl font-bold">${user.public_repos}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Followers</p>
                            <p class="text-2xl font-bold">${user.followers}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Following</p>
                            <p class="text-2xl font-bold">${user.following}</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-8">
                        <div class="flex items-center">
                            <img src="${locationIcon}" alt="location icon" class="w-6 h-6">
                            <p class="ml-4">${user.location || 'Not Available'}</p>
                        </div>
                        <div class="flex items-center">
                            <img src="${websiteIcon}" alt="website icon" class="w-6 h-6">
                            <a href="${user.blog || '#'}" class="ml-4">${user.blog || 'Not Available'}</a>
                        </div>
                        <div class="flex items-center">
                            <img src="${twitterIcon}" alt="twitter icon" class="w-6 h-6">
                            <p class="ml-4">${user.twitter_username || 'Not Available'}</p>
                        </div>
                        <div class="flex items-center">
                            <img src="${companyIcon}" alt="company icon" class="w-6 h-6">
                            <p class="ml-4">${user.company || 'Not Available'}</p>
                        </div>
                    </div>
                </div>
            `;
        } catch (error) {
            userContainer.innerHTML = '';
            errorContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center text-center">
                    <h2 class="text-2xl font-bold">No results found!</h2>
                    <p class="text-gray-500">We couldn’t find any GitHub users matching your search. Please double-check the username and try again.</p>
                </div>
            `;
        }
    }

    searchForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = searchInput.value.trim();
        if (username) {
            fetchUser(username);
        }
    });

    // Fetch initial user
    fetchUser('octocat');
</script>
